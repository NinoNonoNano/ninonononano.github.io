<html>

<head>
    <title>Generatore di Tesori</title>
    <style>
        .amount {
            margin: 50px;
        }
    </style>
    <script>
        window.onload = function() {
            const DAY = 2;
            const YEAR = 4709;
            generateDate(DAY, YEAR);
        };

        function generateDateFromUser() {
            generateDate(document.getElementById("inp_day").value, document.getElementById("inp_year").value);
        }

        function generateDate(DAY, YEAR) {
            // DATA INIZIO 343 4708 = 9 dicembre 2019 bla bla
            // ANNO CORRENTE + 2689


            var months = ['Abadius', 'Calistril', 'Pharast', 'Gozran', 'Desnus', 'Sarenith', 'Erastus', 'Arodus', 'Rova', 'Lamashan', 'Neth', 'Kuthona'];
            var day = ['Moonday', 'Toilday', 'Wealday', 'Oathday', 'Fireday', 'Starday', 'Sunday'];
            var moonPhases = ['ðŸŒ‘', 'ðŸŒ’', 'ðŸŒ“', 'ðŸŒ”', 'ðŸŒ•', 'ðŸŒ–', 'ðŸŒ—', 'ðŸŒ˜'];
            var STARTDATE = new Date(getDateFromDayNum(DAY, YEAR));
            document.getElementById('date').innerHTML = day[STARTDATE.getDay()] + ' ' + STARTDATE.getDate() + ' ' + months[STARTDATE.getMonth()] + ' ' + STARTDATE.getFullYear();
            document.getElementById('day').innerHTML = getDayNumFromDate(STARTDATE);
            document.getElementById('moonPhases').innerHTML = moonPhases[(getMoonPhase(STARTDATE))];
        }

        function getDayNumFromDate(date) {
            var now = new Date(date);
            var start = new Date(now.getFullYear(), 0, 0);
            var diff = (now - start) + ((start.getTimezoneOffset() - now.getTimezoneOffset()) * 60 * 1000);
            var oneDay = 1000 * 60 * 60 * 24;
            var day = Math.floor(diff / oneDay);
            return day;
        }

        function getMoonPhase(date) {
            var day = date.getDay();
            var month = date.getMonth();
            var year = date.getFullYear();
            var c = e = jd = b = 0;

            if (month < 3) {
                year--;
                month += 12;
            }

            ++month;

            c = 365.25 * year;
            e = 30.6 * month;
            jd = c + e + day - 694039.09; //jd is total days elapsed
            jd /= 29.5305882; //divide by the moon cycle
            b = parseInt(jd); //int(jd) -> b, take integer part of jd
            jd -= b; //subtract integer part to leave fractional part of original jd
            b = Math.round(jd * 8); //scale fraction from 0-8 and round

            if (b >= 8) {
                b = 0; //0 and 8 are the same so turn 8 into 0
            }

            return b;
        }

        var getDateFromDayNum = function(dayNum, year) {

            var date = new Date();
            if (year) {
                date.setFullYear(year);
            }
            date.setMonth(0);
            date.setDate(0);
            var timeOfFirst = date.getTime(); // this is the time in milliseconds of 1/1/YYYY
            var dayMilli = 1000 * 60 * 60 * 24;
            var dayNumMilli = dayNum * dayMilli;
            date.setTime(timeOfFirst + dayNumMilli);
            return date;
        }
    </script>
</head>

<body>
    <input name='day' type='number' id='inp_day' />
    <input name='year' type='number' id='inp_year' />
    <button onclick=generateDateFromUser()>Calcola</button>
    <label id='day' class='amount'></label>
    <label id='date' class='amount'></label>
    <label id='moonPhases' class='amount'></label><br>
</body>

</html>